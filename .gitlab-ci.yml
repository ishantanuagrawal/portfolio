# Use Node 20 as the build environment
image: node:20-bookworm

# Cache the npm folder to speed up subsequent builds
cache:
  paths:
    - .npm/

pages:
  stage: deploy
  script:
    # Use 'npm install' instead of 'npm ci' to handle local/CI dependency mismatches automatically
    - npm install --cache .npm --prefer-offline
    # Build the project
    - npm run build
    # GitLab Pages expects content in the 'public' folder. 
    # Vite outputs to 'dist', so we swap them.
    - rm -rf public
    - mv dist public
  artifacts:
    paths:
      - public
  only:
    - main # Only run this job when changes are pushed to the main branch